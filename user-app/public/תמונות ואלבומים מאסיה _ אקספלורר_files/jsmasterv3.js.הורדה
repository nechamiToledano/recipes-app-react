// External Tags
(function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) { return; }
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/he_IL/all.js#xfbml=1&appId=257747294244257";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

$(document).ready(function () {
    $('#backTop').backTop({
        'position': 500,
        'speed': 300,
        'color': 'red'
    });

    CheckShowAdNotification();
});

function selectAvatarMenu() {
    document.getElementById("avatarPanel").className = "top_bar_avatar_panel_fixed";
}

function unselectAvatarMenu() {
    document.getElementById("avatarPanel").className = "top_bar_avatar_panel";
}

function selectToolsMenu() {
    document.getElementById("travelToolsPanel").className = "top_bar_cat_fixed";
}

function unselectToolsMenu() {
    document.getElementById("travelToolsPanel").className = "top_bar_cat";
}

function selectFlightsMenu() {
    document.getElementById("flightsToolsPanel").className = "top_bar_cat_fixed";
}

function unselectFlightsMenu() {
    document.getElementById("flightsToolsPanel").className = "top_bar_cat";
}

function selectTmarketMenu() {
    document.getElementById("tmarketToolsPanel").className = "top_bar_cat_fixed";
}

function unselectTmarketMenu() {
    document.getElementById("tmarketToolsPanel").className = "top_bar_cat";
}

function selectInsuranceMenu() {
    document.getElementById("insuranceToolsPanel").className = "top_bar_cat_fixed";
}

function unselectInsuranceMenu() {
    document.getElementById("insuranceToolsPanel").className = "top_bar_cat";
}

function selectMoreServicesMenu() {
    document.getElementById("moreServicesPanel").className = "top_bar_cat_fixed";
}

function unselectMoreServicesMenu() {
    document.getElementById("moreServicesPanel").className = "top_bar_cat";
}

function selectSearchMenu() {
    document.getElementById("siteSearchPanel").className = "top_bar_avatar_panel_fixed";
}

function unselectSearchMenu() {
    document.getElementById("siteSearchPanel").className = "top_bar_avatar_panel";
}

function selectGuideMenu() {
    document.getElementById("flightsGuidePanel").className = "top_bar_cat_fixed";
}

function unselectGuideMenu() {
    document.getElementById("flightsGuidePanel").className = "top_bar_cat";
}

function selectCustomerServiceMenu() {
    document.getElementById("customerServicePanel").className = "top_bar_cat_fixed";
}

function unselectCustomerServiceMenu() {
    document.getElementById("customerServicePanel").className = "top_bar_cat";
}

function ShowSiteSearchPopup() {
    siteSearchPopup.Show();
}

function HideSiteSearchPopup() {
    siteSearchPopup.Hide();
}

function OnClientAddPlaceItemsRequested(sender, eventArgs) {
    sender.clearItems();

    if (sender.get_text().length < 2) {
        eventArgs.set_cancel(true);

        var dropDownDiv = sender.get_dropDownElement();
        dropDownDiv.firstChild.style.height = "0px";
        document.getElementById("search_icon_div").style.display = 'block';
        document.getElementById("add_place_loader").style.display = 'none';
    }
}

function SetAddPlaceDropDownHeight(sender, eventArgs) {
    document.getElementById("search_icon_div").style.display = 'block';
    document.getElementById("add_place_loader").style.display = 'none';
}

function HandleAddPlaceKeyPressing(sender, args) {
    var comboText = sender.get_text();

    if (comboText.length > 1) {
        document.getElementById("add_place_loader").style.display = 'block';
        document.getElementById("search_icon_div").style.display = 'none';
    }
}

var is_ie = false;

if (navigator.appName == "Microsoft Internet Explorer") {
    is_ie = true;
}


function ShowSiteScroller() {
    document.documentElement.style.overflow = "auto";
}

// Frames Set Height on Resize
var contentHeight = "0";
var contentWidth = "0";

$(document).ready(function () {
    SetFramesHeight();
});

$(window).resize(function () {
    SetFramesHeight();
});

function SetFramesHeight() {
    contentHeight = $(window).height();
    contentWidth = $(window).width();

    var imagesViewerFrame = document.getElementById("imagesViewerFrame");
    var imagesPopupDiv = document.getElementById("imagesPopupDiv");
    var loadingImagesDiv = document.getElementById("loadingImagesDiv");
    var loadingImagesViewer = document.getElementById("loadingImagesViewer");

    imagesPopupDiv.style.height = contentHeight;
    imagesViewerFrame.height = (contentHeight - 52) + "px";
    loadingImagesViewer.style.height = (contentHeight - 52) + "px";
    loadingImagesDiv.style.marginTop = ((contentHeight - 142) / 2) + "px";

    var external_site_frame = document.getElementById("external_site_frame");
    var ExternalSitePopupDiv = document.getElementById("ExternalSitePopupDiv");
    var loadingExternalSiteDiv = document.getElementById("loadingExternalSiteDiv");

    ExternalSitePopupDiv.style.height = contentHeight + "px";
    external_site_frame.height = (contentHeight - 60) + "px";
    loadingExternalSiteDiv.style.marginTop = ((contentHeight - 142) / 2) + "px";
}

// Show Last Searches Popup
function ShowLastSearchesPopup(map_url) {
    ShowExternalSitePopup('/tools/last_searches', 0, 0);
}

//Show External Site Popup
var do_back = 1;

function ShowExternalSitePopup(url, back, mode) {
    if (back == 1) {
        do_back = 0;
    }

    var btnCloseExternalSitePopup = document.getElementById("btnCloseExternalSitePopup");

    if (mode == 1) {
        btnCloseExternalSitePopup.className = "backToFlights";
    }
    else if (mode == 2) {
        btnCloseExternalSitePopup.className = "backCloseMap";
    }
    else {
        btnCloseExternalSitePopup.className = "backToXplorer";
    }

    var MasterExternalSitePanel = document.getElementById("MasterExternalSitePanel");
    var frame = document.getElementById("external_site_frame");
    var storedHash = window.location.hash;

    if (storedHash.indexOf("#") == -1) {
        window.location += "#mode=external";
    }

    var loadingDisplay = document.getElementById('loadingExternalSitePopup').style;
    loadingDisplay.display = 'block';
    document.getElementById("loadingExternalSitePopup").style.height = contentHeight;

    if (!is_ie) {
        frame.contentWindow.location.replace(url);
    } else {
        frame.src = url;
    }

    document.documentElement.style.overflow = "hidden";
    MasterExternalSitePanel.style.display = "block";

    if (frame.attachEvent) {
        frame.attachEvent('onload', HideLoadingExternalSitePopup);
    } else if (frame.addEventListener) {
        frame.addEventListener('load', HideLoadingExternalSitePopup, false);
    } else {
        frame.onload = HideLoadingExternalSitePopup;
    }

    setTimeout(function () { HideLoadingExternalSitePopup() }, 10000);

    var backTopDiv = document.getElementById("backTopDiv");
    backTopDiv.style.display = 'none';
}

function HideLoadingExternalSitePopup() {
    var loadingDisplay = document.getElementById('loadingExternalSitePopup').style;
    var frame = document.getElementById("external_site_frame");

    loadingDisplay.display = 'none';
    frame.contentWindow.focus();
}

function HideExternalSitePopup() {
    var MasterExternalSitePanel = document.getElementById("MasterExternalSitePanel");
    document.documentElement.style.overflow = "auto";
    MasterExternalSitePanel.style.display = "none";

    var frame = document.getElementById("external_site_frame");

    try {
        if (!is_ie) {
            frame.contentWindow.location.replace('');
            frame.src = '';
        } else {
            frame.src = '';
            frame.contentWindow.location.replace('');
        }
    }
    catch (e) {
    }
}

function HideExternalSitePopupNoScrollHidden() {
    var MasterExternalSitePanel = document.getElementById("MasterExternalSitePanel");
    MasterExternalSitePanel.style.display = "none";

    var frame = document.getElementById("external_site_frame");

    if (!is_ie) {
        frame.contentWindow.location.replace('');
    } else {
        frame.src = '';
    }
}

function HideExternalPopup() {
    if (do_back == 1) {
        history.back();
    }

    var MasterExternalSitePanel = document.getElementById("MasterExternalSitePanel");
    MasterExternalSitePanel.style.display = "none";
    document.documentElement.style.overflow = "auto";

    var backTopDiv = document.getElementById("backTopDiv");
    backTopDiv.style.display = 'block';
}

//Hiding external Site On Back Button
if ("onhashchange" in window) { // event supported?
    window.onhashchange = function() {
        var storedHash = window.location.hash;

        if (storedHash.indexOf("#") == -1) {
            HideExternalSitePopup();
        }
    };
} else { // event not supported:
    var storedHash = window.location.hash;
    window.setInterval(function() {
        if (window.location.hash != storedHash) {
            storedHash = window.location.hash;

            if (storedHash.indexOf("#") == -1) {
                HideExternalSitePopup();
            }
        }
    }, 1000);
}

function showPopup(url) {
    if (getCookie("RedirectPopup") == null) {
        window.open(url, '_blank', 'toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=976,height=509');
    }
}

function getCookie(name) {
    var dc = document.cookie;
    var prefix = name + "=";
    var begin = dc.indexOf("; " + prefix);
    if (begin == -1) {
        begin = dc.indexOf(prefix);
        if (begin != 0) return null;
    } else {
        begin += 2;
        var end = document.cookie.indexOf(";", begin);
        if (end == -1) {
            end = dc.length;
        }
    }
    return unescape(dc.substring(begin + prefix.length, end));
}

// Login Popup
function ShowSiteLoginPopup() {
    siteLoginPopup.Show();
}

function HideSiteLoginPopup() {
    siteLoginPopup.Hide();
}

function HideSiteRegisterPopup() {
    siteRegisterPopup.Hide();
}

function PasswordMaskFocus(sender, eventArgs) {
    try {
        $get('passwordMaskDiv').style.display = 'none';
        $get('passwordRealDiv').style.display = 'inline';
        $find('txtLoginPassword').focus();
    } catch (e) {
    }
}

function PasswordBlur(sender, eventArgs) {
    if (sender.isEmpty()) {
        $get('passwordMaskDiv').style.display = 'inline';
        $get('passwordRealDiv').style.display = 'none';
    }
}

function ResetPasswordMaskFocus(sender, eventArgs) {
    try {
        $get('newPasswordMaskDiv').style.display = 'none';
        $get('newPasswordRealDiv').style.display = 'inline';
        $find('txtResetPassword').focus();
    } catch (e) {
    }
}

function ResetPasswordBlur(sender, eventArgs) {
    if (sender.isEmpty()) {
        $get('newPasswordMaskDiv').style.display = 'inline';
        $get('newPasswordRealDiv').style.display = 'none';
    }
}

function VerifyPasswordMaskFocus(sender, eventArgs) {
    try {
        $get('verifyPasswordMaskDiv').style.display = 'none';
        $get('verifyPasswordRealDiv').style.display = 'inline';
        $find('txtVerifyResetPassword').focus();
    } catch (e) {
    }
}

function VerifyResetPasswordBlur(sender, eventArgs) {
    if (sender.isEmpty()) {
        $get('verifyPasswordMaskDiv').style.display = 'inline';
        $get('verifyPasswordRealDiv').style.display = 'none';
    }
}

function RegisterPasswordMaskFocus(sender, eventArgs) {
    try {
        $get('registerPasswordMaskDiv').style.display = 'none';
        $get('registerPasswordRealDiv').style.display = 'inline';
        $find('txtRegisterPassword').focus();
    } catch (e) {
    }
}

function RegisterPasswordBlur(sender, eventArgs) {
    if (sender.isEmpty()) {
        $get('registerPasswordMaskDiv').style.display = 'inline';
        $get('registerPasswordRealDiv').style.display = 'none';
    }
}

function RegisterVerifyPasswordMaskFocus(sender, eventArgs) {
    try {
        $get('registerVerifyPasswordMaskDiv').style.display = 'none';
        $get('regusterVerifyPasswordRealDiv').style.display = 'inline';
        $find('txtRegisterVerifyPassword').focus();
    } catch (e) {
    }
}

function RegisterVerifyPasswordBlur(sender, eventArgs) {
    if (sender.isEmpty()) {
        $get('registerVerifyPasswordMaskDiv').style.display = 'inline';
        $get('regusterVerifyPasswordRealDiv').style.display = 'none';
    }
}

function ShowLoginPanel() {
    $get('popupLoginPanel').style.display = 'block';
    $get('popupRegisterPanel').style.display = 'none';
    $get('popupForgotPasswordPanel').style.display = 'none';

    try {
        $get('popupResetPasswordPanel').style.display = 'none';
    }
    catch (e) {
    }
}

function ShowRegisterPanel() {
    $get('popupLoginPanel').style.display = 'none';
    $get('popupRegisterPanel').style.display = 'block';
    $get('popupForgotPasswordPanel').style.display = 'none';

    try {
        $get('popupResetPasswordPanel').style.display = 'none';
    }
    catch (e) {
    }
}

function ShowForgotPasswordPanel() {
    $get('popupLoginPanel').style.display = 'none';
    $get('popupRegisterPanel').style.display = 'none';
    $get('popupForgotPasswordPanel').style.display = 'block';

    try {
        $get('popupResetPasswordPanel').style.display = 'none';
    }
    catch (e) {
    }
}

function ShowLoginLoading() {
    document.getElementById("login_form_div").style.display = "none";
    document.getElementById("login_form_loader_div").style.display = "block";
}

function ShowRegisterLoading() {
    document.getElementById("register_form_div").style.display = "none";
    document.getElementById("register_form_loader_div").style.display = "block";
}

function ShowForgotPasswordLoading() {
    document.getElementById("forgot_password_form_div").style.display = "none";
    document.getElementById("forgot_password_form_loader_div").style.display = "block";
}

function ShowResetPasswordLoading() {
    document.getElementById("reset_password_div").style.display = "none";
    document.getElementById("reset_password_loader_div").style.display = "block";
}

function ShowSiteRegisterLoading() {
    document.getElementById("siteRegisterPanel").style.display = "none";
    document.getElementById("siteRegisterLoaderPanel").style.display = "block";
}

function ShowImagesPopup(type, obj, index, id) {
    var MasterImagesPopupPanel = document.getElementById("MasterImagesPopupPanel");
    var frame = document.getElementById("imagesViewerFrame");

    var loadingDisplay = document.getElementById('loadingImagesViewer').style;
    loadingDisplay.display = 'block';

    var storedHash = window.location.hash;

    if (storedHash.indexOf("#") == -1) {
        window.location += "#mode=images";
    }

    document.getElementById("loadingImagesViewer").style.height = contentHeight;

    if (id == undefined) {
        frame.src = "/services/images?type=" + type + "&obj=" + obj + "&index=" + index;
    } else {
        frame.src = "/services/images?type=" + type + "&obj=" + obj + "&index=" + index + "&id=" + id;
    }

    MasterImagesPopupPanel.style.display = "block";
    document.documentElement.style.overflow = "hidden";

    if (frame.attachEvent) {
        frame.attachEvent('onload', HideLoadingImagesViewer);
    } else if (frame.addEventListener) {
        frame.addEventListener('load', HideLoadingImagesViewer, false);
    } else {
        frame.onload = HideLoadingImagesViewer;
    }

    var backTopDiv = document.getElementById("backTopDiv");
    backTopDiv.style.display = 'none';
}


function HideLoadingImagesViewer() {
    var loadingDisplay = document.getElementById('loadingImagesViewer').style;
    var frame = document.getElementById("imagesViewerFrame");

    loadingDisplay.display = 'none';
    frame.contentWindow.focus();
}


function HideImagesPopup() {
    var MasterImagesPopupPanel = document.getElementById("MasterImagesPopupPanel");
    document.documentElement.style.overflow = "auto";
    MasterImagesPopupPanel.style.display = "none";

    var frame = document.getElementById("imagesViewerFrame");

    try {
        if (!is_ie) {
            frame.contentWindow.location.replace('');
            frame.src = '';
        } else {
            frame.src = '';
            frame.contentWindow.location.replace('');
        }
    }
    catch (e) {
    }
}

function ShowJoinNewsletterLoader() {
    document.getElementById("joinNewsletterDiv").style.display = "none";
    document.getElementById("joinNewsletterLoadingDiv").style.display = "block";
}

function ShowBeforeExitPopup() {
    beforeExitPopup.Show();
}

function HideBeforeExitPopup() {
    beforeExitPopup.Hide();
}

function ShowWelcomePopupWithDelay() {
    $(document).ready(function () {
        setTimeout(ShowWelcomePopup, 2000);
    });
}

function ShowWelcomePopup() {
    welcomePopup.Show();
}

function HideWelcomePopup() {
    welcomePopup.Hide();
}

function ShowBeforeExitNewsletterLoader() {
    document.getElementById("btnBeforeExitAddNewsletter").style.display = "none";
    document.getElementById("beforeExitAddNewsletterLoading").style.display = "block";
}

function CheckShowAdNotification() {
    var ShowAdNotification = document.getElementById("ShowAdNotification");

    if (ShowAdNotification.value == "1") {
        setTimeout(function () { $("#toggle_ad").toggle("slide"); }, 1500);
    }
}

var close_action = 0;

function HideAdNotification() {
    close_action = 1;
    $("#toggle_ad").toggle("slide");
}

function navigateToAd(url) {
    if (close_action == 0) {
        window.open(url, '_blank');
    }
}

function ShowMasterAllFlightsDests() {
    document.getElementById("showMoreDestsPnl").style.display = "none";
    document.getElementById("moreDestsPnl").style.display = "block";
}

function navigateToPage(url) {
    window.open(url, '_self');
}

function NavigateToAddContent(url) {
    window.open(url, "_blank");
}
